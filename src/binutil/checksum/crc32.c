
#include <stdint.h>

#include "binutil/checksum/crc32.h"

#ifdef __CRC32_DISABLE_TABLE

uint32_t crc32_direct(uint32_t crc, const char *buf, uint16_t len){
	
	crc = ~crc;
	while (len--) {
		crc ^= *buf++;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
		crc = crc & 1 ? (crc >> 1) ^ CRC32_POLYNOMIAL : crc >> 1;
	}
	return ~crc;
}


#else

uint32_t digital_update_crc32(uint32_t crc, const char *data, uint16_t len){
	static const uint32_t table[256] = { 
		0uL, 1996959894uL, 3993919788uL, 2567524794uL, 124634137uL, 1886057615uL, 
		3915621685uL, 2657392035uL, 249268274uL, 2044508324uL, 3772115230uL, 2547177864uL, 
		162941995uL, 2125561021uL, 3887607047uL, 2428444049uL, 498536548uL, 1789927666uL, 
		4089016648uL, 2227061214uL, 450548861uL, 1843258603uL, 4107580753uL, 2211677639uL, 
		325883990uL, 1684777152uL, 4251122042uL, 2321926636uL, 335633487uL, 1661365465uL, 
		4195302755uL, 2366115317uL, 997073096uL, 1281953886uL, 3579855332uL, 2724688242uL, 
		1006888145uL, 1258607687uL, 3524101629uL, 2768942443uL, 901097722uL, 1119000684uL, 
		3686517206uL, 2898065728uL, 853044451uL, 1172266101uL, 3705015759uL, 2882616665uL, 
		651767980uL, 1373503546uL, 3369554304uL, 3218104598uL, 565507253uL, 1454621731uL, 
		3485111705uL, 3099436303uL, 671266974uL, 1594198024uL, 3322730930uL, 2970347812uL, 
		795835527uL, 1483230225uL, 3244367275uL, 3060149565uL, 1994146192uL, 31158534uL, 
		2563907772uL, 4023717930uL, 1907459465uL, 112637215uL, 2680153253uL, 3904427059uL, 
		2013776290uL, 251722036uL, 2517215374uL, 3775830040uL, 2137656763uL, 141376813uL, 
		2439277719uL, 3865271297uL, 1802195444uL, 476864866uL, 2238001368uL, 4066508878uL, 
		1812370925uL, 453092731uL, 2181625025uL, 4111451223uL, 1706088902uL, 314042704uL, 
		2344532202uL, 4240017532uL, 1658658271uL, 366619977uL, 2362670323uL, 4224994405uL, 
		1303535960uL, 984961486uL, 2747007092uL, 3569037538uL, 1256170817uL, 1037604311uL, 
		2765210733uL, 3554079995uL, 1131014506uL, 879679996uL, 2909243462uL, 3663771856uL, 
		1141124467uL, 855842277uL, 2852801631uL, 3708648649uL, 1342533948uL, 654459306uL, 
		3188396048uL, 3373015174uL, 1466479909uL, 544179635uL, 3110523913uL, 3462522015uL, 
		1591671054uL, 702138776uL, 2966460450uL, 3352799412uL, 1504918807uL, 783551873uL, 
		3082640443uL, 3233442989uL, 3988292384uL, 2596254646uL, 62317068uL, 1957810842uL, 
		3939845945uL, 2647816111uL, 81470997uL, 1943803523uL, 3814918930uL, 2489596804uL, 
		225274430uL, 2053790376uL, 3826175755uL, 2466906013uL, 167816743uL, 2097651377uL, 
		4027552580uL, 2265490386uL, 503444072uL, 1762050814uL, 4150417245uL, 2154129355uL, 
		426522225uL, 1852507879uL, 4275313526uL, 2312317920uL, 282753626uL, 1742555852uL, 
		4189708143uL, 2394877945uL, 397917763uL, 1622183637uL, 3604390888uL, 2714866558uL, 
		953729732uL, 1340076626uL, 3518719985uL, 2797360999uL, 1068828381uL, 1219638859uL, 
		3624741850uL, 2936675148uL, 906185462uL, 1090812512uL, 3747672003uL, 2825379669uL, 
		829329135uL, 1181335161uL, 3412177804uL, 3160834842uL, 628085408uL, 1382605366uL, 
		3423369109uL, 3138078467uL, 570562233uL, 1426400815uL, 3317316542uL, 2998733608uL, 
		733239954uL, 1555261956uL, 3268935591uL, 3050360625uL, 752459403uL, 1541320221uL, 
		2607071920uL, 3965973030uL, 1969922972uL, 40735498uL, 2617837225uL, 3943577151uL, 
		1913087877uL, 83908371uL, 2512341634uL, 3803740692uL, 2075208622uL, 213261112uL, 
		2463272603uL, 3855990285uL, 2094854071uL, 198958881uL, 2262029012uL, 4057260610uL, 
		1759359992uL, 534414190uL, 2176718541uL, 4139329115uL, 1873836001uL, 414664567uL, 
		2282248934uL, 4279200368uL, 1711684554uL, 285281116uL, 2405801727uL, 4167216745uL, 
		1634467795uL, 376229701uL, 2685067896uL, 3608007406uL, 1308918612uL, 956543938uL, 
		2808555105uL, 3495958263uL, 1231636301uL, 1047427035uL, 2932959818uL, 3654703836uL, 
		1088359270uL, 936918000uL, 2847714899uL, 3736837829uL, 1202900863uL, 817233897uL, 
		3183342108uL, 3401237130uL, 1404277552uL, 615818150uL, 3134207493uL, 3453421203uL, 
		1423857449uL, 601450431uL, 3009837614uL, 3294710456uL, 1567103746uL, 711928724uL, 
		3020668471uL, 3272380065uL, 1510334235uL, 755167117uL};
		
		while (len > 0)
		{
			crc = table[(crc ^ *data) & 0xff] ^ (crc >> 8);
			data++;
			len--;
		}
		return crc;
}

uint32_t crc32_lookup(uint32_t crc, const char *buf, uint16_t len){
	return ~digital_update_crc32(~crc, buf, len);
}

#endif
